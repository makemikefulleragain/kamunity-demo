"use strict";(()=>{var e={};e.id=73,e.ids=[73],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8642:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>p});var i={};r.r(i),r.d(i,{GET:()=>u});var o=r(9303),a=r(8716),s=r(3131),c=r(7070),n=r(9660);async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("sourceType"),i=t.get("sourceId"),o=t.get("userId"),a="true"===t.get("includePrivate");if("true"===t.get("my")&&o){let e="false"!==t.get("includeAssigned"),r="false"!==t.get("includeCreated"),i=await (0,n.gF)(o,e,r);return c.NextResponse.json({success:!0,data:i})}if(!r||!i)return c.NextResponse.json({success:!1,error:"sourceType and sourceId are required"},{status:400});if(!["chat","focus_room","club","community"].includes(r))return c.NextResponse.json({success:!1,error:"Invalid sourceType"},{status:400});let s=await (0,n.zS)(r,i,a);return c.NextResponse.json({success:!0,data:s})}catch(e){return console.error("Error in GET /api/actions/by-source:",e),c.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to fetch actions by source"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/actions/by-source/route",pathname:"/api/actions/by-source",filename:"route",bundlePath:"app/api/actions/by-source/route"},resolvedPagePath:"C:\\dev\\kamunity-final\\src\\app\\api\\actions\\by-source\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:y}=d,g="/api/actions/by-source/route";function m(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:p})}},9660:(e,t,r)=>{r.d(t,{Aq:()=>p,Gx:()=>c,Jj:()=>l,PH:()=>o,Sv:()=>s,TA:()=>d,Tg:()=>m,gF:()=>g,hl:()=>a,mn:()=>n,qv:()=>u,zS:()=>y});let i=new(r(3524)).PrismaClient;async function o(e){try{let t=await i.action.create({data:{title:e.title,description:e.description,actionType:e.actionType,impactLevel:e.impactLevel,sourceType:e.sourceType,status:e.status,priority:e.priority||"medium",createdBy:e.createdBy,assignedTo:e.assignedTo||[],volunteers:e.volunteers||[],ownershipType:e.ownershipType,isPublic:e.isPublic||!1,promotedFromPrivate:e.promotedFromPrivate||!1,sourceId:e.sourceId,sourceMessageId:e.sourceMessageId,detectionMethod:e.detectionMethod,isConfirmed:e.isConfirmed||!1,dueDate:e.dueDate,estimatedEffort:e.estimatedEffort,requiredSkills:e.requiredSkills||[],tags:e.tags||[],focusRoomId:e.focusRoomId,statusConfig:e.statusConfig},include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"}},focusRoom:!0}});return await u({actionId:t.id,userId:e.createdBy,activityType:"created",description:`Action "${e.title}" was created`,metadata:{initialStatus:e.status,detectionMethod:e.detectionMethod}}),t}catch(e){throw console.error("Error creating action:",e),Error("Failed to create action")}}async function a(e){try{return await i.action.findUnique({where:{id:e},include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"}},focusRoom:!0}})}catch(e){throw console.error("Error fetching action:",e),Error("Failed to fetch action")}}async function s(e={},t={field:"createdAt",direction:"desc"},r=50,o=0){try{let a={};e.actionType?.length&&(a.actionType={in:e.actionType}),e.impactLevel?.length&&(a.impactLevel={in:e.impactLevel}),e.sourceType?.length&&(a.sourceType={in:e.sourceType}),e.status?.length&&(a.status={in:e.status}),e.priority?.length&&(a.priority={in:e.priority}),void 0!==e.isPublic&&(a.isPublic=e.isPublic),e.assignedToMe&&(a.assignedTo={has:e.assignedToMe}),e.createdByMe&&(a.createdBy=e.createdByMe),(e.dueDate?.from||e.dueDate?.to)&&(a.dueDate={},e.dueDate.from&&(a.dueDate.gte=e.dueDate.from),e.dueDate.to&&(a.dueDate.lte=e.dueDate.to)),e.tags?.length&&(a.tags={hasSome:e.tags}),e.searchQuery&&(a.OR=[{title:{contains:e.searchQuery,mode:"insensitive"}},{description:{contains:e.searchQuery,mode:"insensitive"}}]);let s={};s[t.field]=t.direction;let[c,n]=await Promise.all([i.action.findMany({where:a,include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"},take:3},focusRoom:!0},orderBy:s,take:r,skip:o}),i.action.count({where:a})]);return{actions:c,total:n}}catch(e){throw console.error("Error fetching actions:",e),Error("Failed to fetch actions")}}async function c(e,t,r){try{let o=await i.action.findUnique({where:{id:e}});if(!o)throw Error("Action not found");let a=await i.action.update({where:{id:e},data:{...t,updatedAt:new Date},include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"}},focusRoom:!0}});return t.status&&t.status!==o.status&&await u({actionId:e,userId:r,activityType:"status_changed",description:`Status changed from "${o.status}" to "${t.status}"`,metadata:{previousStatus:o.status,newStatus:t.status}}),t.assignedTo&&JSON.stringify(t.assignedTo)!==JSON.stringify(o.assignedTo)&&await u({actionId:e,userId:r,activityType:"assigned",description:"Assignment updated",metadata:{previousAssignees:o.assignedTo,newAssignees:t.assignedTo}}),a}catch(e){throw console.error("Error updating action:",e),Error("Failed to update action")}}async function n(e){try{await i.action.delete({where:{id:e}})}catch(e){throw console.error("Error deleting action:",e),Error("Failed to delete action")}}async function u(e){try{return await i.actionActivity.create({data:{actionId:e.actionId,userId:e.userId,activityType:e.activityType,description:e.description,metadata:e.metadata},include:{user:!0,action:!0}})}catch(e){throw console.error("Error creating action activity:",e),Error("Failed to create action activity")}}async function d(e,t=20){try{return await i.actionActivity.findMany({where:{actionId:e},include:{user:!0},orderBy:{createdAt:"desc"},take:t})}catch(e){throw console.error("Error fetching action activities:",e),Error("Failed to fetch action activities")}}async function l(e,t,r,i){let o=[],a=[/(?:by|due|deadline)\s+([a-zA-Z]+ \d{1,2})/gi,/(?:next|this)\s+(week|month|friday|monday|tuesday|wednesday|thursday|saturday|sunday)/gi],s=[/(\d+)\s+(hour|hours|day|days|week|weeks)/gi,/(quick|fast|simple|complex|difficult)/gi];for(let{pattern:t,type:r,confidence:i}of[{pattern:/(?:need to|should|must|let's|we should)\s+([^.!?]+)/gi,type:"task",confidence:.7},{pattern:/(?:meeting|event|gathering|workshop)\s+([^.!?]+)/gi,type:"event",confidence:.8},{pattern:/(?:propose|suggest|idea)\s+([^.!?]+)/gi,type:"proposal",confidence:.6},{pattern:/(?:need help|looking for|seeking)\s+([^.!?]+)/gi,type:"resource_needed",confidence:.8}]){let c;for(;null!==(c=t.exec(e));){let t=c[1].trim();if(t.length>10){let c,n;for(let t of a){let r=t.exec(e);if(r){r[1];break}}for(let t of s){let r=t.exec(e);if(r){n=r[0];break}}let u="individual";e.includes("community")||e.includes("everyone")||e.includes("all")?u="community":e.includes("neighborhood")||e.includes("local")?u="local":(e.includes("system")||e.includes("policy")||e.includes("government"))&&(u="systemic"),o.push({confidence:i,suggestedTitle:t.length>50?t.substring(0,50)+"...":t,suggestedDescription:t,suggestedType:r,suggestedImpactLevel:u,extractedMetadata:{dueDate:c,estimatedEffort:n,requiredSkills:[],tags:[]}})}}}return o}async function p(e,t){try{let r=await c(e,{isPublic:!0,promotedFromPrivate:!0},t);return await u({actionId:e,userId:t,activityType:"status_changed",description:"Action promoted to public visibility",metadata:{promotionType:"private_to_public"}}),r}catch(e){throw console.error("Error promoting action:",e),Error("Failed to promote action")}}async function y(e,t,r=!1){try{let o={sourceType:e,sourceId:t};return r||(o.isPublic=!0),await i.action.findMany({where:o,include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"},take:3},focusRoom:!0},orderBy:{createdAt:"desc"}})}catch(e){throw console.error("Error fetching actions by source:",e),Error("Failed to fetch actions by source")}}async function g(e,t=!0,r=!0){try{let o=[];return r&&o.push({createdBy:e}),t&&o.push({assignedTo:{has:e}}),await i.action.findMany({where:{OR:o},include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"},take:3},focusRoom:!0},orderBy:{updatedAt:"desc"}})}catch(e){throw console.error("Error fetching user actions:",e),Error("Failed to fetch user actions")}}async function m(e={}){try{let t={};e.sourceType?.length&&(t.sourceType={in:e.sourceType}),void 0!==e.isPublic&&(t.isPublic=e.isPublic);let[r,o,a,s,c,n]=await Promise.all([i.action.count({where:t}),i.action.groupBy({by:["actionType"],where:t,_count:{actionType:!0}}),i.action.groupBy({by:["status"],where:t,_count:{status:!0}}),i.action.groupBy({by:["impactLevel"],where:t,_count:{impactLevel:!0}}),i.action.groupBy({by:["priority"],where:t,_count:{priority:!0}}),i.action.count({where:{...t,status:{in:["completed","impact_assessed"]}}})]);return{total:r,byType:Object.fromEntries(o.map(e=>[e.actionType,e._count.actionType])),byStatus:Object.fromEntries(a.map(e=>[e.status,e._count.status])),byImpactLevel:Object.fromEntries(s.map(e=>[e.impactLevel,e._count.impactLevel])),byPriority:Object.fromEntries(c.map(e=>[e.priority,e._count.priority])),completionRate:r>0?n/r*100:0}}catch(e){throw console.error("Error fetching action stats:",e),Error("Failed to fetch action stats")}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948,972],()=>r(8642));module.exports=i})();