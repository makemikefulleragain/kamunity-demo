"use strict";(()=>{var e={};e.id=558,e.ids=[558],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9533:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>y,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var i={};r.r(i),r.d(i,{DELETE:()=>l,GET:()=>u,PUT:()=>d});var s=r(9303),o=r(8716),a=r(3131),n=r(7070),c=r(9660);async function u(e,{params:t}){try{let{id:e}=t;if(!e)return n.NextResponse.json({success:!1,error:"Action ID is required"},{status:400});let r=await (0,c.hl)(e);if(!r)return n.NextResponse.json({success:!1,error:"Action not found"},{status:404});return n.NextResponse.json({success:!0,data:r})}catch(e){return console.error("Error in GET /api/actions/[id]:",e),n.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to fetch action"},{status:500})}}async function d(e,{params:t}){try{let{id:r}=t,i=await e.json();if(!r)return n.NextResponse.json({success:!1,error:"Action ID is required"},{status:400});if(!i.updatedBy)return n.NextResponse.json({success:!1,error:"updatedBy field is required"},{status:400});if(i.actionType&&!["task","event","initiative","proposal","resource_needed"].includes(i.actionType))return n.NextResponse.json({success:!1,error:"Invalid actionType"},{status:400});if(i.impactLevel&&!["individual","local","community","systemic"].includes(i.impactLevel))return n.NextResponse.json({success:!1,error:"Invalid impactLevel"},{status:400});if(i.sourceType&&!["chat","focus_room","club","community"].includes(i.sourceType))return n.NextResponse.json({success:!1,error:"Invalid sourceType"},{status:400});if(i.priority&&!["low","medium","high","urgent"].includes(i.priority))return n.NextResponse.json({success:!1,error:"Invalid priority"},{status:400});if(i.ownershipType&&!["self_assigned","leader_assigned","community_driven"].includes(i.ownershipType))return n.NextResponse.json({success:!1,error:"Invalid ownershipType"},{status:400});if(i.detectionMethod&&!["auto","manual","hybrid"].includes(i.detectionMethod))return n.NextResponse.json({success:!1,error:"Invalid detectionMethod"},{status:400});i.dueDate&&(i.dueDate=new Date(i.dueDate));let s=i.updatedBy;delete i.updatedBy;let o=await (0,c.Gx)(r,i,s);return n.NextResponse.json({success:!0,data:o})}catch(e){return console.error("Error in PUT /api/actions/[id]:",e),n.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to update action"},{status:500})}}async function l(e,{params:t}){try{let{id:e}=t;if(!e)return n.NextResponse.json({success:!1,error:"Action ID is required"},{status:400});return await (0,c.mn)(e),n.NextResponse.json({success:!0,message:"Action deleted successfully"})}catch(e){return console.error("Error in DELETE /api/actions/[id]:",e),n.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to delete action"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/actions/[id]/route",pathname:"/api/actions/[id]",filename:"route",bundlePath:"app/api/actions/[id]/route"},resolvedPagePath:"C:\\dev\\kamunity-final\\src\\app\\api\\actions\\[id]\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:m,serverHooks:f}=p,h="/api/actions/[id]/route";function g(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},9660:(e,t,r)=>{r.d(t,{Aq:()=>p,Gx:()=>n,Jj:()=>l,PH:()=>s,Sv:()=>a,TA:()=>d,Tg:()=>f,gF:()=>m,hl:()=>o,mn:()=>c,qv:()=>u,zS:()=>y});let i=new(r(3524)).PrismaClient;async function s(e){try{let t=await i.action.create({data:{title:e.title,description:e.description,actionType:e.actionType,impactLevel:e.impactLevel,sourceType:e.sourceType,status:e.status,priority:e.priority||"medium",createdBy:e.createdBy,assignedTo:e.assignedTo||[],volunteers:e.volunteers||[],ownershipType:e.ownershipType,isPublic:e.isPublic||!1,promotedFromPrivate:e.promotedFromPrivate||!1,sourceId:e.sourceId,sourceMessageId:e.sourceMessageId,detectionMethod:e.detectionMethod,isConfirmed:e.isConfirmed||!1,dueDate:e.dueDate,estimatedEffort:e.estimatedEffort,requiredSkills:e.requiredSkills||[],tags:e.tags||[],focusRoomId:e.focusRoomId,statusConfig:e.statusConfig},include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"}},focusRoom:!0}});return await u({actionId:t.id,userId:e.createdBy,activityType:"created",description:`Action "${e.title}" was created`,metadata:{initialStatus:e.status,detectionMethod:e.detectionMethod}}),t}catch(e){throw console.error("Error creating action:",e),Error("Failed to create action")}}async function o(e){try{return await i.action.findUnique({where:{id:e},include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"}},focusRoom:!0}})}catch(e){throw console.error("Error fetching action:",e),Error("Failed to fetch action")}}async function a(e={},t={field:"createdAt",direction:"desc"},r=50,s=0){try{let o={};e.actionType?.length&&(o.actionType={in:e.actionType}),e.impactLevel?.length&&(o.impactLevel={in:e.impactLevel}),e.sourceType?.length&&(o.sourceType={in:e.sourceType}),e.status?.length&&(o.status={in:e.status}),e.priority?.length&&(o.priority={in:e.priority}),void 0!==e.isPublic&&(o.isPublic=e.isPublic),e.assignedToMe&&(o.assignedTo={has:e.assignedToMe}),e.createdByMe&&(o.createdBy=e.createdByMe),(e.dueDate?.from||e.dueDate?.to)&&(o.dueDate={},e.dueDate.from&&(o.dueDate.gte=e.dueDate.from),e.dueDate.to&&(o.dueDate.lte=e.dueDate.to)),e.tags?.length&&(o.tags={hasSome:e.tags}),e.searchQuery&&(o.OR=[{title:{contains:e.searchQuery,mode:"insensitive"}},{description:{contains:e.searchQuery,mode:"insensitive"}}]);let a={};a[t.field]=t.direction;let[n,c]=await Promise.all([i.action.findMany({where:o,include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"},take:3},focusRoom:!0},orderBy:a,take:r,skip:s}),i.action.count({where:o})]);return{actions:n,total:c}}catch(e){throw console.error("Error fetching actions:",e),Error("Failed to fetch actions")}}async function n(e,t,r){try{let s=await i.action.findUnique({where:{id:e}});if(!s)throw Error("Action not found");let o=await i.action.update({where:{id:e},data:{...t,updatedAt:new Date},include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"}},focusRoom:!0}});return t.status&&t.status!==s.status&&await u({actionId:e,userId:r,activityType:"status_changed",description:`Status changed from "${s.status}" to "${t.status}"`,metadata:{previousStatus:s.status,newStatus:t.status}}),t.assignedTo&&JSON.stringify(t.assignedTo)!==JSON.stringify(s.assignedTo)&&await u({actionId:e,userId:r,activityType:"assigned",description:"Assignment updated",metadata:{previousAssignees:s.assignedTo,newAssignees:t.assignedTo}}),o}catch(e){throw console.error("Error updating action:",e),Error("Failed to update action")}}async function c(e){try{await i.action.delete({where:{id:e}})}catch(e){throw console.error("Error deleting action:",e),Error("Failed to delete action")}}async function u(e){try{return await i.actionActivity.create({data:{actionId:e.actionId,userId:e.userId,activityType:e.activityType,description:e.description,metadata:e.metadata},include:{user:!0,action:!0}})}catch(e){throw console.error("Error creating action activity:",e),Error("Failed to create action activity")}}async function d(e,t=20){try{return await i.actionActivity.findMany({where:{actionId:e},include:{user:!0},orderBy:{createdAt:"desc"},take:t})}catch(e){throw console.error("Error fetching action activities:",e),Error("Failed to fetch action activities")}}async function l(e,t,r,i){let s=[],o=[/(?:by|due|deadline)\s+([a-zA-Z]+ \d{1,2})/gi,/(?:next|this)\s+(week|month|friday|monday|tuesday|wednesday|thursday|saturday|sunday)/gi],a=[/(\d+)\s+(hour|hours|day|days|week|weeks)/gi,/(quick|fast|simple|complex|difficult)/gi];for(let{pattern:t,type:r,confidence:i}of[{pattern:/(?:need to|should|must|let's|we should)\s+([^.!?]+)/gi,type:"task",confidence:.7},{pattern:/(?:meeting|event|gathering|workshop)\s+([^.!?]+)/gi,type:"event",confidence:.8},{pattern:/(?:propose|suggest|idea)\s+([^.!?]+)/gi,type:"proposal",confidence:.6},{pattern:/(?:need help|looking for|seeking)\s+([^.!?]+)/gi,type:"resource_needed",confidence:.8}]){let n;for(;null!==(n=t.exec(e));){let t=n[1].trim();if(t.length>10){let n,c;for(let t of o){let r=t.exec(e);if(r){r[1];break}}for(let t of a){let r=t.exec(e);if(r){c=r[0];break}}let u="individual";e.includes("community")||e.includes("everyone")||e.includes("all")?u="community":e.includes("neighborhood")||e.includes("local")?u="local":(e.includes("system")||e.includes("policy")||e.includes("government"))&&(u="systemic"),s.push({confidence:i,suggestedTitle:t.length>50?t.substring(0,50)+"...":t,suggestedDescription:t,suggestedType:r,suggestedImpactLevel:u,extractedMetadata:{dueDate:n,estimatedEffort:c,requiredSkills:[],tags:[]}})}}}return s}async function p(e,t){try{let r=await n(e,{isPublic:!0,promotedFromPrivate:!0},t);return await u({actionId:e,userId:t,activityType:"status_changed",description:"Action promoted to public visibility",metadata:{promotionType:"private_to_public"}}),r}catch(e){throw console.error("Error promoting action:",e),Error("Failed to promote action")}}async function y(e,t,r=!1){try{let s={sourceType:e,sourceId:t};return r||(s.isPublic=!0),await i.action.findMany({where:s,include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"},take:3},focusRoom:!0},orderBy:{createdAt:"desc"}})}catch(e){throw console.error("Error fetching actions by source:",e),Error("Failed to fetch actions by source")}}async function m(e,t=!0,r=!0){try{let s=[];return r&&s.push({createdBy:e}),t&&s.push({assignedTo:{has:e}}),await i.action.findMany({where:{OR:s},include:{creator:!0,activities:{include:{user:!0},orderBy:{createdAt:"desc"},take:3},focusRoom:!0},orderBy:{updatedAt:"desc"}})}catch(e){throw console.error("Error fetching user actions:",e),Error("Failed to fetch user actions")}}async function f(e={}){try{let t={};e.sourceType?.length&&(t.sourceType={in:e.sourceType}),void 0!==e.isPublic&&(t.isPublic=e.isPublic);let[r,s,o,a,n,c]=await Promise.all([i.action.count({where:t}),i.action.groupBy({by:["actionType"],where:t,_count:{actionType:!0}}),i.action.groupBy({by:["status"],where:t,_count:{status:!0}}),i.action.groupBy({by:["impactLevel"],where:t,_count:{impactLevel:!0}}),i.action.groupBy({by:["priority"],where:t,_count:{priority:!0}}),i.action.count({where:{...t,status:{in:["completed","impact_assessed"]}}})]);return{total:r,byType:Object.fromEntries(s.map(e=>[e.actionType,e._count.actionType])),byStatus:Object.fromEntries(o.map(e=>[e.status,e._count.status])),byImpactLevel:Object.fromEntries(a.map(e=>[e.impactLevel,e._count.impactLevel])),byPriority:Object.fromEntries(n.map(e=>[e.priority,e._count.priority])),completionRate:r>0?c/r*100:0}}catch(e){throw console.error("Error fetching action stats:",e),Error("Failed to fetch action stats")}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948,972],()=>r(9533));module.exports=i})();