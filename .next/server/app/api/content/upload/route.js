"use strict";(()=>{var e={};e.id=738,e.ids=[738],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:e=>{e.exports=require("path")},9338:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{POST:()=>c});var a=r(9303),i=r(8716),n=r(3131),s=r(7070);let p=require("fs/promises");var l=r(5315);let u=new(r(3524)).PrismaClient,d={"image/jpeg":".jpg","image/png":".png","image/gif":".gif","application/pdf":".pdf","text/plain":".txt","application/vnd.openxmlformats-officedocument.wordprocessingml.document":".docx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":".xlsx"};async function c(e){try{var t;let r=await e.formData(),o=r.get("file"),a=r.get("roomId"),i=r.get("userId")||"anonymous";if(!o)return s.NextResponse.json({error:"No file provided"},{status:400});if(!a)return s.NextResponse.json({error:"Room ID required"},{status:400});if(!d[o.type])return s.NextResponse.json({error:"File type not allowed. Supported: images, PDF, text, Word, Excel"},{status:400});if(o.size>10485760)return s.NextResponse.json({error:"File too large. Maximum size: 10MB"},{status:400});let n=(0,l.join)(process.cwd(),"public","uploads",a);await (0,p.mkdir)(n,{recursive:!0});let c=Date.now();d[o.type];let m=`${c}-${o.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,f=(0,l.join)(n,m),x=await o.arrayBuffer(),g=Buffer.from(x);await (0,p.writeFile)(f,g);let y=await u.contentUpload.create({data:{filename:o.name,storedFilename:m,fileType:(t=o.type).startsWith("image/")?"image":"application/pdf"===t||t.includes("word")||t.includes("text")||t.includes("sheet")||t.includes("excel")?"document":"other",fileSize:o.size,mimeType:o.type,uploaderId:i,focusRoomId:a,storageLocation:`/uploads/${a}/${m}`},include:{uploader:!0,reactions:!0}});return s.NextResponse.json({success:!0,upload:{id:y.id,filename:y.filename,fileType:y.fileType,fileSize:y.fileSize,uploadedAt:y.uploadedAt,url:y.storageLocation,uploader:y.uploader}})}catch(e){return console.error("Upload error:",e),s.NextResponse.json({error:"Upload failed. Please try again."},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/content/upload/route",pathname:"/api/content/upload",filename:"route",bundlePath:"app/api/content/upload/route"},resolvedPagePath:"C:\\dev\\kamunity-final\\src\\app\\api\\content\\upload\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:g}=m,y="/api/content/upload/route";function v(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,972],()=>r(9338));module.exports=o})();